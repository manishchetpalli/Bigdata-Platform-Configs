events { }

http {

  log_format upstream_time '$remote_addr - $remote_user [$time_local] '
                             '"$request" $status $body_bytes_sent '
                             '"$http_referer" "$http_user_agent"'
                             'rt=$request_time uct="$upstream_connect_time" uht="$upstream_header_time" urt="$upstream_response_time"';

  access_log /home/access.log;
  server_tokens off;

  proxy_set_header Host       $http_host;
  proxy_set_header X-Real-IP  $remote_addr;
  client_max_body_size 0;
  chunked_transfer_encoding on;


  upstream yanagishima {
        server yanagishima:8080;
  }

  server {
      listen 80;
      server_name presto.domain.tld;

      location / {
        auth_basic "Administratorâ€™s Area";
        auth_basic_user_file /etc/nginx/.htpasswdadmin;

        proxy_set_header        Host $host:$server_port;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto $scheme;

        proxy_pass          http://yanagishima;
        proxy_read_timeout  90;
      }
  }

}