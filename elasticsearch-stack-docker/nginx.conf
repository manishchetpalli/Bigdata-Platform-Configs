worker_processes 1;

events { worker_connections 1024; }

http {

   log_format upstream_time '$remote_addr - $remote_user [$time_local] '
                         '"$request" $status $body_bytes_sent '
                         '"$http_referer" "$http_user_agent"'
                         'rt="$request_time" uct="$upstream_connect_time" uht="$upstream_header_time" urt="$upstream_response_time"';


    access_log /home/access_instance01.log upstream_time;
    error_log /home/error_instance01.log error;


    client_max_body_size 2048M;
    server_tokens off;
    proxy_intercept_errors on;

    upstream elasticsearch {
        # no load balancing method is specified for Round Robin
        server es01:9200;
        server es02:9200;
        server es03:9200 backup;
    }

    server {
        listen 80;

        #if ($request_method !~ ^(GET|HEAD|POST)$ )
        #{
        #       return 405;
        #}

        location /nginx_status {
              stub_status;
        }

        location / {


            proxy_pass            http://elasticsearch/;
            proxy_redirect off;
            proxy_read_timeout    90;
            proxy_connect_timeout 90;
            proxy_set_header      Host $host;
            proxy_set_header      X-Real-IP $remote_addr;
            proxy_set_header      X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header      Connection "Keep-Alive";
            proxy_set_header      Proxy-Connection "Keep-Alive";
            proxy_set_header      Proxy "";
            proxy_intercept_errors on;



        }

        #error_page 404 =200 /error_404.html;
        #location = /error_404.html {
        #    root /var/www/error/;
        #    internal;
        #}

        error_page 404 =200 @error404;
        location @error404 {
          root /var/www/error/;
          default_type "application/json";

          if ($request_uri ~ /myfavs) {return 404 '{"_index": "abc","_type": "api","_id": "9999999999","found": false,"_source": {"mobileNo": "9999999999","pincode": "400054","myShoppingList": [{"article": "490000041","articleDesc": "AASHIRVAAD WHOLE WHEAT ATTA 10 kg PP"}, {"article": "490176160","articleDesc": "LOOSE SUGAR M"}, {"article": "490007389","articleDesc": "GOLD WINNER REFINED SUNFLOWER OIL 1 L PP"}, {"article": "490001392","articleDesc": "AMUL BUTTER 500 g CBD"}, {"article": "590000594","articleDesc": "AMUL FULL CRM MILK 500 ml PP"}, {"article": "491062305","articleDesc": "CADBURY DAIRY MILK HOME PK 126 g PP"}, {"article": "490001795","articleDesc": "MAAZA 1.2 L PET"}, {"article": "491187481","articleDesc": "BOURNVITA SHAKTI 750 g CBD"}, {"article": "490004180","articleDesc": "TATA TEA PR LEAF 1 kg TPK"}, {"article": "490003834","articleDesc": "MAGGI 2MINUTE NOODLES MSALA 560 g PP"}, {"article": "491161888","articleDesc": "BRIT GOODDAY CSHW 600 g PP"}, {"article": "490007739","articleDesc": "BRITANNIA PREMIUM BAKE RUSK 273 g PP"}, {"article": "490015763","articleDesc": "SURF EXCEL EASY WASH DETRGNT PWDR 4kg PP"}, {"article": "490008332","articleDesc": "CLOSE UP RED PASTE 300 g CBD"}, {"article": "490337869","articleDesc": "PEARS PURE & GENTLE SOAP 125 g x 3 CBD"}]}}';}



         return 404 '{"_index":"jiomart_saathi","_type":"api","_id":"0000000000","_score":1,"found":false,"_source":{"referenceKey":"0000000000","orderDetails":[{"TOT_ORDER_AMT":"00.0","CONTACTNUMBER":"0000000000","ORDERDATE":"2100-15-40 00:00:00","AIRMAIL_ID":"11111111111111111R"}]}}';

}



    }

}